[{"name": "app.py", "content": "# \"\"\"\n# Title: Daylight App\n# Author: Jonathan Roberts\n# \"\"\"\n\n# import modules\nimport requests\nimport pandas as pd\nfrom shiny.express import input, render, ui\nfrom shiny import reactive\nfrom shinywidgets import render_widget\nimport ipyleaflet as Map\nfrom datetime import datetime\nfrom shinyswatch import theme\n\n# location options\ncities = {\n    \"Null Island\": (0, 0),\n    \"Cardiff\": (51.483333, -3.183333),\n    \"London\": (51.507222, -0.1275),\n    \"Edinburgh\": (55.953333, -3.189167),\n    \"Belfast\": (54.596389, -5.93),\n}\n\n# --------------------------------------------------------\n# Shiny Application UI Elements\n# --------------------------------------------------------\n\nui.page_opts(title=\"\u2600\ufe0f Daylight Time\")\n\nwith ui.sidebar():\n    ui.input_select(\"city\", \"Select City\", choices=list(cities.keys()), selected=\"London\")\n    ui.input_date(\"date\", \"Select Date\")\n    \"Toggle Dark Mode\"\n    ui.input_dark_mode(mode=\"light\")\n    ui.input_action_button(\"show_info\", \"App Info\")\n\n\nwith ui.layout_column_wrap(fill=False):\n\n    with ui.value_box():\n        \"Sunrise\"\n\n        @render.express\n        def sunrise():\n            get_df().results[\"sunrise\"]\n\n    with ui.value_box():\n        \"Sunset\"\n\n        @render.express\n        def sunset():\n            get_df().results[\"sunset\"]\n\n    with ui.value_box():\n        \"Day Length\"\n\n        @render.express\n        def day_length():\n            get_df().results[\"day_length\"]\n\n    with ui.value_box():\n        \"Date\"\n\n        @render.express\n        def date_selected():\n            input.date().strftime(\"%d %b %Y\")\n\nwith ui.card():\n    ui.card_header(\"Map\")\n\n    @render_widget\n    def map():\n        return Map.Map(zoom=12, center=cities[input.city()])\n\n# --------------------------------------------------------\n# Reactive calculations and effects\n# --------------------------------------------------------\n\n@reactive.calc\ndef get_df():\n    city = input.city()\n    date = input.date()\n    # post request to the api\n    url = 'https://api.sunrisesunset.io/json?'\n    params = {\n        \"lat\": cities[city][0],\n        \"lng\": cities[city][1],\n        \"date\": date,\n    }\n    r = requests.post(url, params=params)\n    df = pd.DataFrame(r.json())\n    return df\n\n\n@reactive.effect\n@reactive.event(input.reset)\ndef _():\n    ui.update_select(\"city\")\n\n\n@reactive.effect\n@reactive.event(input.show_info)\ndef show_important_message():\n    m = ui.modal(\n        ui.markdown(\"This shiny python app displays the sunrise and sunset time, as well as the length of daylight time for the selected day. The application submits post requests to the [Sunrise Sunset API](https://sunrisesunset.io/api/) for a slection of cities across the United Kingdom.\"),\n        title=\"Application Information\",\n        easy_close=True,\n        footer=None,\n    )\n    ui.modal_show(m)\n", "type": "text"}, {"name": "requirements.txt", "content": "shiny\nseaborn\npandas", "type": "text"}, {"name": "shared.py", "content": "from pathlib import Path\n\nimport pandas as pd\n\napp_dir = Path(__file__).parent\ndf = pd.read_csv(app_dir / \"penguins.csv\")\n", "type": "text"}]